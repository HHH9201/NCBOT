# 📚 数据库字典 - 中文说明文档

## 🗄️ 数据库位置
**文件路径**: `/home/hjh/BOT/NCBOT/mydb/mydb.db`

---

## 📊 数据表总览

| 表名 | 中文名称 | 功能说明 | 所属插件 |
|-----|---------|---------|---------|
| `speak_rank` | 发言排行榜 | 记录群员发言次数 | SpeakRank插件 |
| `sign_in_records` | 签到记录表 | 记录每日签到详情 | 签到插件 |
| `user_points` | 用户积分表 | 记录用户积分总览 | 签到插件 |

---

## 🗣️ speak_rank 表 - 发言排行榜

### 表结构说明
记录每个群员的发言次数，用于生成发言排行榜。

| 字段名 | 数据类型 | 中文说明 | 详细描述 |
|-------|---------|---------|---------|
| `id` | INTEGER | 主键ID | 自增主键，唯一标识每条记录 |
| `group_id` | TEXT | 群号 | QQ群号码，用于区分不同群 |
| `user_id` | TEXT | 用户QQ号 | 群成员的QQ号码 |
| `speak_count` | INTEGER | 发言次数 | 累计发言次数，默认0 |
| `last_speak_time` | TIMESTAMP | 最后发言时间 | 记录最后一次发言的时间 |

### 索引信息
- `idx_group_user`: 群号和用户QQ号的联合索引
- `idx_speak_count`: 发言次数的降序索引

---

## 📅 sign_in_records 表 - 签到记录表

### 表结构说明
记录用户每日签到的详细信息，包括获得的积分和连续签到天数。

| 字段名 | 数据类型 | 中文说明 | 详细描述 |
|-------|---------|---------|---------|
| `id` | INTEGER | 主键ID | 自增主键，唯一标识每条签到记录 |
| `user_id` | TEXT | 用户QQ号 | 签到用户的QQ号码 |
| `group_id` | TEXT | 群号 | 用户所在QQ群号码 |
| `sign_date` | DATE | 签到日期 | 签到的日期（年-月-日） |
| `points_earned` | INTEGER | 获得积分 | 本次签到获得的积分数 |
| `consecutive_days` | INTEGER | 连续天数 | 连续签到天数 |
| `total_points` | INTEGER | 总积分 | 签到后的累计总积分 |
| `created_at` | TIMESTAMP | 创建时间 | 记录创建的时间戳 |

### 约束条件
- 联合唯一约束：同一用户在同一群的同一天只能有一条签到记录

---

## 💎 user_points 表 - 用户积分表

### 表结构说明
记录用户的积分总览信息，包括总积分和连续签到情况。

| 字段名 | 数据类型 | 中文说明 | 详细描述 |
|-------|---------|---------|---------|
| `id` | INTEGER | 主键ID | 自增主键，唯一标识每个用户记录 |
| `user_id` | TEXT | 用户QQ号 | 用户的QQ号码 |
| `group_id` | TEXT | 群号 | 用户所在QQ群号码 |
| `total_points` | INTEGER | 总积分 | 用户的累计总积分数 |
| `consecutive_days` | INTEGER | 连续签到天数 | 当前连续签到天数 |
| `last_sign_date` | DATE | 最后签到日期 | 最后一次签到的日期 |
| `updated_at` | TIMESTAMP | 更新时间 | 记录最后更新的时间戳 |

### 约束条件
- 联合唯一约束：同一用户在同一群只能有一条记录

---

## 🔄 数据关系图

```
用户签到流程：
┌─────────────┐     ┌─────────────────┐     ┌──────────────┐
│  user_points│◄────┤ sign_in_records │◄────┤   签到操作    │
│  (积分总览)  │     │  (签到记录)      │     │ (每日签到)   │
└─────────────┘     └─────────────────┘     └──────────────┘
      │                       │
      │                       │
      ▼                       ▼
┌─────────────┐     ┌─────────────────┐
│  积分排行榜  │     │  签到历史查询    │
│  (统计展示)  │     │  (记录查询)      │
└─────────────┘     └─────────────────┘
```

---

## 📋 常用查询示例

### 查询用户积分
```sql
-- 查询指定用户在指定群的积分信息
SELECT 
    total_points as '总积分',
    consecutive_days as '连续签到天数',
    last_sign_date as '最后签到日期'
FROM user_points 
WHERE user_id = '用户QQ号' AND group_id = '群号';
```

### 查询签到记录
```sql
-- 查询指定用户最近7天的签到记录
SELECT 
    sign_date as '签到日期',
    points_earned as '获得积分',
    consecutive_days as '连续天数'
FROM sign_in_records 
WHERE user_id = '用户QQ号' AND group_id = '群号'
ORDER BY sign_date DESC 
LIMIT 7;
```

### 积分排行榜
```sql
-- 查询指定群的积分排行榜前10名
SELECT 
    user_id as '用户QQ',
    total_points as '总积分',
    consecutive_days as '连续签到'
FROM user_points 
WHERE group_id = '群号'
ORDER BY total_points DESC, consecutive_days DESC
LIMIT 10;
```

---

## ⚠️ 注意事项

1. **数据隔离**：每个群的数据相互独立，不会混淆
2. **时间格式**：日期格式为 `YYYY-MM-DD`，时间格式为 `YYYY-MM-DD HH:MM:SS`
3. **唯一约束**：防止同一用户同一天重复签到
4. **自动更新**：`created_at` 和 `updated_at` 字段会自动记录时间
5. **积分规则**：基础10分 + 连续签到奖励 + 随机奖励

---

## 📝 更新记录

| 日期 | 版本 | 更新内容 |
|-----|-----|---------|
| 2025-01-01 | v1.0.0 | 创建数据库字典文档 |
| 2025-01-01 | v1.0.0 | 添加签到插件相关表说明 |

---

💡 **提示**：如需查看实时数据，可以使用 SQLite 浏览器工具或命令行：`sqlite3 /home/hjh/BOT/NCBOT/mydb/mydb.db`